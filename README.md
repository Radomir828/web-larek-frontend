# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в приложении

категории карточек

```
type categoryType =
	| 'софт-скил'
	| 'дополнительное'
	| 'другое'
	| 'кнопка'
	| 'хард-скил';
```

Интерфейс товара

```
interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: categoryType;
	price: number | null;
}
```

данные товара, находящегося в корзине

```
type IBasketItem = Pick<IProduct, 'id' | 'title' | 'price'>;
```

тип оплаты

```
type paymentMethod = 'online' | 'offline';
```

данные формы заказа

```
 interface IOrderForm {
	payment: paymentMethod;
	address: string;
}
```

данные формы контактов

```
 interface IContactForm {
	email: string;
	phone: string;
}
```

данные заказа, которые отправляются на сервер

```
 interface IOrder extends IOrderForm, IContactForm {
	items: string[];
	total: number;
}
```

данные ответа от сервера в случае успешного заказа

```
 interface IOrderResult {
	id: string;
	total: number;
}
```

тип для хранения ошибок полей ввода формы

```
 type FormErrors = Partial<Record<keyof IOrder, string>>;
```

Api нашего приложения

```
 interface ILarekApi {
	getCatalog(): Promise<IProduct[]>;
	getCatalogItem(id: string): Promise<IProduct>;
	orderItems(order: IOrder): Promise<IOrderResult>;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных. Код презентера не будет выделен в отдельный класс, а будет размещен в основном скрипте приложения(src/index.ts)

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Model

Абстрактный класс, служит базовым классом для моделей данных. Конструктор принимает начальные данные и объект событий.
Поля:

- `data`: Частичные данные модели (Partial\<T\>\).

- `events`: Объект для управления событиями.

Методы:

- `emitChanges(event, payload)`: Уведомляет подписчиков об изменениях в модели.

#### Класс Component

Класс Component — это абстрактный базовый класс для модели представления. Он предоставляет инструменты для работы с DOM: управление классами, текстом, видимостью, изображениями и состоянием элементов.

### Слой коммуникации

#### Класс LarekApi

Расширяет базовый класс `Api` и реализует интерфейс `ILarekApi`

- `cdn`: Базовый URL для изображений товаров

- `getCatalog()`: Возвращает список товаров, добавляя к их изображениям базовый URL (cdn).

- `getCatalogItem(id: string)`: Возвращает конкретный товар по ID, также добавляя к его изображению базовый URL.

- `orderItems(order: IOrder)`: Отправляет заказ на сервер и возвращает результат.

### Слой данных

#### Класс Catalog

Этот класс Catalog реализует интерфейс `ICatalog` и отвечает за управление каталогом товаров

В полях класса хранятся следующие данные:

- `catalog`: Список всех товаров.
- `total`: Количество товаров в каталоге.
- `preview`: ID товара, который сейчас просматривается (или null, если ничего не выбрано).

Класс предоставляет набор методов для взаимодействия с этими данными:

- `setCatalog(items: IProduct[])`: Устанавливает список товаров и обновляет их количество и и уведомляет об изменении каталога товаров

- `getCatalogItems()`: Возвращает весь список товаров.

- `getCatalogItem(id: string)`: Находит товар по его ID.

- `setPreview(item: IProduct)`: Устанавливает товар для предпросмотра и уведомляет об изменении.

#### Класс Order

Класс для управления корзиной товаров и оформления заказа: добавление/удаление товаров, подсчёт стоимости, заполнение и валидация данных заказа.

Поля:

- `basket`: Корзина товаров, хранящаяся как Set для уникальности.

- `order`: Частичный объект заказа (Partial<IOrder>), который заполняется данными.

- `formErrors`: Ошибки валидации полей заказа.

Методы:

Работа с корзиной:

- `addToBasket(item: IProduct):` Добавляет товар в корзину.

- `removeFromBasket(item: IProduct)`: Удаляет товар из корзины.

- `getBasket()`: Возвращает корзину в виде массива.

- `getBasketAmount()`: Возвращает общую стоимость товаров в корзине.

Работа с заказом:

- `setOrderField<K extends keyof IOrder>(field: K, value: IOrder[K])`: Устанавливает значение для поля заказа и валидирует его.

- `validateOrder()`: Проверяет корректность данных заказа и возвращает true, если ошибок нет.
