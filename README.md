https://github.com/Radomir828/web-larek-frontend.git

# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных используемые в приложении

категории карточек

```
type categoryType =
	| 'софт-скил'
	| 'дополнительное'
	| 'другое'
	| 'кнопка'
	| 'хард-скил';
```

Интерфейс товара

```
interface IProduct {
	id: string;
	description: string;
	image: string;
	title: string;
	category: categoryType;
	price: number | null;
}
```

данные товара, находящегося в корзине

```
type IBasketItem = Pick<IProduct, 'id' | 'title' | 'price'>;
```

тип оплаты

```
type paymentMethod = 'cash' | 'card' | '';
```

данные формы заказа

```
 interface IOrderForm {
	payment: paymentMethod;
	address: string;
}
```

данные формы контактов

```
 interface IContactForm {
	email: string;
	phone: string;
}
```

данные заказа, которые отправляются на сервер

```
 interface IOrder extends IOrderForm, IContactForm {
	items: string[];
	total: number;
}
```

данные ответа от сервера в случае успешного заказа

```
 interface IOrderResult {
	id: string;
	total: number;
}
```

тип для хранения ошибок полей ввода формы

```
 type FormErrors = Partial<Record<keyof IOrder, string>>;
```

Api нашего приложения

```
 interface ILarekApi {
	getCatalog(): Promise<IProduct[]>;
	getCatalogItem(id: string): Promise<IProduct>;
	orderItems(order: IOrder): Promise<IOrderResult>;
}
```

## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP:

- слой представления, отвечает за отображение данных на странице,
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных. Код презентера не будет выделен в отдельный класс, а будет размещен в основном скрипте приложения(src/index.ts)

### Базовый код

#### Класс Api

Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы:

- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter

Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:

- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие

#### Класс Model

Абстрактный класс, служит базовым классом для моделей данных. Конструктор принимает начальные данные и объект событий.
Поля:

- `data`: Частичные данные модели (Partial\<T\>\).

- `events`: Объект для управления событиями.

Методы:

- `emitChanges(event, payload)`: Уведомляет подписчиков об изменениях в модели.

#### Класс Component

Класс является дженериком и родителем всех компонентов слоя представления. В дженерик принимает тип объекта, в котором данные будут передаваться в метод render для отображения данных в компоненте. В конструктор принимает элемент разметки, являющийся основным родительским контейнером компонента. Содержит метод render, отвечающий за сохранение полученных в параметре данных в полях компонентов через их сеттеры, возвращает обновленный контейнер компонента.

### Слой коммуникации

#### Класс LarekApi

Расширяет базовый класс `Api` и реализует интерфейс `ILarekApi`

- `cdn`: Базовый URL для изображений товаров

- `getCatalog(): Promise<IProduct[]>`: Возвращает список товаров, добавляя к их изображениям базовый URL (cdn).

- `getCatalogItem(id: string): Promise<IProduct>`: Возвращает конкретный товар по ID, также добавляя к его изображению базовый URL.

- `orderItems(order: IOrder): Promise<IOrderResult>`: Отправляет заказ на сервер и возвращает результат.

### Слой данных

#### Класс Catalog

Класс Catalog реализует интерфейс `ICatalog` и отвечает за управление каталогом товаров

В полях класса хранятся следующие данные:

- `catalog`: Список всех товаров.
- `total`: Количество товаров в каталоге.

Класс предоставляет набор методов для взаимодействия с этими данными:

- `setCatalog(items: IProduct[])`: Устанавливает список товаров и обновляет их количество и и уведомляет об изменении каталога товаров

- `getCatalogItems(): IProduct[]`: Возвращает весь список товаров.

- `getCatalogItem(id: string): IProduct`: Находит товар по его ID.

- `setPreview(item: IProduct)`: Устанавливает товар для предпросмотра и уведомляет об изменении.

#### Класс Order

Класс для управления корзиной товаров и оформления заказа: добавление/удаление товаров, подсчёт стоимости, заполнение и валидация данных заказа.

Поля:

- `basket`: Корзина товаров, хранящаяся как Set для уникальности.

- `order`: Частичный объект заказа (Partial<IOrder>), который заполняется данными.

- `formErrors`: Ошибки валидации полей заказа.

Методы:

Работа с корзиной:

- `addToBasket(item: IProduct):` Добавляет товар в корзину.

- `removeFromBasket(item: IProduct)`: Удаляет товар из корзины.

- `getBasket(): IBasketItem[]`: Возвращает корзину в виде массива.

- `getBasketAmount()`: Возвращает общую стоимость товаров в корзине.

- `clearBasket(): void`: очищает корзину

- `getBasketItem(id: string): IBasketItem`: Возвращает товар из корзины

- `isInBasket(item: IProduct): boolean`: проверяет находится ли элемент в корзине

Работа с заказом:

- `setOrderItems(): string[]`: Возвращает массив идентификаторов (id) всех товаров, находящихся в корзине.

- `setOrderField<K extends keyof IOrderForm>(field: K, value: IOrder[K])`
  Устанавливает значение поля из формы заказа (payment или address) в объект заказа.

- `setContactField<K extends keyof IContactForm>(field: K, value: IOrder[K])`: Устанавливает значение поля из формы контактов (email или phone) в объект заказа.

- `validateOrder(): boolean`: Проверяет заполненность полей payment и address(форма заказа).

- `validateContacts(): boolean`: Проверяет заполненность полей email и phone(форма контактов).

### Слой представления

Все классы представления отвечают за отображение внутри контейнера (DOM-элемент) передаваемых в них данных.

#### Класс Page

Данный класс расширяет класс Component. Отвечает за отображение основных элементов страницы, таких как каталог товаров, кнопка корзины, счётчик товаров и блокировка интерфейса во время модальных состояний.

В конструкторе производится выборка ключевых элементов страницы и установка слушателя на кнопку корзины.

Поля класса

- `catalogContainer: HTMLElement` — контейнер, в который добавляются карточки товаров -`counterElement: HTMLElement` — элемент, отображающий количество товаров в корзине -`basketButton: HTMLButtonElement` — кнопка открытия корзины -`wrapperElement: HTMLElement` — основной блок всей страницы

Сеттеры:

- `set catalog(items: HTMLElement[])` - Обновляет содержимое каталога товаров, заменяя все карточки

- `set counter(value: number)` - Обновляет текстовое содержимое счётчика товаров в корзине.

- `set locked(value: boolean)` - Добавляет или удаляет класс page\_\_wrapper_locked на обёртке страницы, блокируя/разблокируя взаимодействие с интерфейсом.

#### Класс Card

Класс расширяет Component. Отображает карточку товара в каталоге или модальном окне. Умеет отображать основную информацию о товаре и реагировать на действия пользователя.

Внутри конструктора производится выборка всех внутренних элементов карточки и установка нужных обработчиков событий.

- `categoryElement: HTMLElement` — элемент, в который отображается категория товара
- `titleElement: HTMLElement` — заголовок карточки (название товара).
- `imageElement: HTMLImageElement` — картинка товара.
- `priceElement: HTMLElement` — блок с ценой товара
- `cardButton?: HTMLButtonElement` - кнопка добавления в корзину

Для класса написаны сеттеры, которые рендерят данные товара в карточку.
Эти сеттеры реализованы на основе интерфейса `IProduct`:id, title, category, image, price

#### Класс CardPreview

Расширяет Card, добавляя отображение дополнительного текстового описания товара

`descriptionElement: HTMLElement` — отображает подробное описание товара.
Сеттер: `set description(value: string)` — устанавливает текст описания.

#### Класс Modal

Отвечает за отображение модального окна на странице. Управляет показом/скрытием модалки и вставкой нужного контента внутрь. Также обрабатывает события закрытия по клику на фон или на кнопку закрытия.

Внутри конструктора получаются элементы разметки и добавляются обработчики событий: при клике на фон или кнопку — модалка закрывается

Поля класса

- `contentElement` — блок, в который подставляется содержимое модального окна
- `closeButton` — кнопка закрытия модального окна

Методы

```
interface IModal {
	content: HTMLElement;
}
```

- `set content(value: HTMLElement)` - Обновляет содержимое модального окна.
  Сеттер реализован для интерфейса `IModal`

-`open(): void` - добавляет класс `modal_active`, делая окно видимым, и генерирует событие modal:open

- `close(): void` Удаляет класс modal_active и генерирует событие modal:close.

#### Класс Basket

Расширяет класс Component. Отвечает за отображение модального окна корзины. Управляет списком товаров, общей стоимостью и состоянием кнопки оформления заказа.

Поля класса

- `basketListElement` — список товаров в корзине
- `basketButtonelement` — кнопка «Оформить»
- `basketpriceElement` — текстовый элемент с итоговой суммой

Тип данных, на основе которого реализованы сеттеры

```
interface IBasket {
	basketList: HTMLElement[];
	totalPrice: number;
}
```

#### Класс BasketItem

Расширяет класс Component. Отвечает за отображение одного товара в списке корзины. Позволяет отрисовать название, цену и индекс, а также удаляет товар из корзины при клике на кнопку.

Поля класса:
`basketItemIndex` — элемент, в который выводится порядковый номер товара в списке корзины.
`basketItemTitle` — элемент для отображения названия товара.
`basketItemPrice` — элемент для отображения цены товара.
`basketItemButton` — кнопка удаления товара из корзины.

Сеттеры реализованы для всех полей(id, title, price, index), описанных в интерфейсе IBasketItemView, который объединяет данные товара и его позицию:

```
interface IBasketItemView extends IBasketItem {
	index: number;
}
```

#### Класс Form<T>

Базовый абстрактный класс для работы с HTML-формами. Обеспечивает обработку ввода, валидации, отображения ошибок и отправки формы

Поля:

- `_submit` — кнопка отправки формы
- `_errors` — контейнер для вывода ошибок

Методы:

- `onInputChange(field, value)` - Генерирует событие изменения конкретного поля формы.

- `set valid(value: boolean)` - Включает/отключает кнопку отправки формы.

- `set errors(value: string)` -Записывает текст ошибки в \_errors.

- `resetForm()` - Сбрасывает содержимое формы до первоначального состояния

#### Класс OrderForm

Расширяет базовую форму `Form<IOrderForm>` и добавляет поддержку выбора способа оплаты с помощью кнопок
Поля:

- `paymentTypeButtons` — массив кнопок выбора способа оплаты (.button_alt)

Методы:

- `setButtonOutline(button)` - Добавляет класс button_alt-active только на выбранную кнопку, снимает с остальных.

- `override resetForm()` - Расширяет метод resetForm базового класса — сбрасывает форму и снимает активность со всех кнопок выбора оплаты.

#### Класс ContactForm

Форма для ввода контактных данных пользователя (email и телефон). Использует базовый функционал формы без дополнительных расширений.

#### Класс Success

Класс Success расширяет базовый класс Component и отображает экран успешного оформления заказа с финальной информацией о списанной сумме.

Поля:

- `buttonElement` — кнопка «За новыми покупками!». При нажатии на кнопку `buttonElement` генерируется событие `order-success:close` — это может быть использовано для закрытия модального окна и очистки состояния приложения.

- `descriptionElement` — элемент, в который выводится сумма списанных синапсов

Методы:

- `set total(value: number)`Сеттер для установки текста суммы списанных синапсов. Формирует текст вида: `списано 1234 синапсов` и вставляет в descriptionElement

## Взаимодействие компонентов

Код, описывающий взаимодействие представления и данных между собой находится в файле `index.ts`, выполняющем роль презентера.\
Взаимодействие осуществляется за счет событий генерируемых с помощью брокера событий и обработчиков этих событий, описанных в `index.ts`\
В `index.ts` сначала создаются экземпляры всех необходимых классов, а затем настраивается обработка событий.

_Список всех событий, которые могут генерироваться в системе:_\
_События изменения данных (генерируются классами моделями данных)_

- `catalog:changed` - изменился каталог товаров
- `preview:changed` - изменился выбранный товар (предпросмотр)
- `basket:changed` - изменилась корзина (добавление/удаление товара)
- `orderFormErrors:change` - ошибки валидации формы заказа
- `contactFormErrors:change` - ошибки валидации формы контактов

_События, возникающие при взаимодействии пользователя с интерфейсом (генерируются классами, отвечающими за представление)_

- `card:selected` - пользователь кликнул по карточке (открыть превью)
- `basket:open` - пользователь открыл корзину
- `basket:addedToBasket` - пользователь добавил товар в корзину
- `basket:removedFromBasket` - пользователь удалил товар из корзины
- `basket:order` — пользователь нажал кнопку «Оформить»
- `order:submit` — пользователь отправил форму заказа
- `contacts:submit` — пользователь отправил форму контактов
- `order-success:close` — пользователь закрыл окно успешного заказа
- `modal:open` — открылось модальное окно
- `modal:close` — закрылось модальное окно
- `/^order\..*:change/` — пользователь изменил поле в форме заказа
- `/^contacts\..*:change/` — пользователь изменил поле в форме контактов
